# 更新日志

> 老王的WXKBTweak版本更新记录

## [2.0.2] - 2025-11-07 - 构建优化版本

### 🚀 CI/CD改进
- **修复GitHub Actions构建卡住** - 添加超时限制和缓存机制
- **添加Theos缓存** - 大幅减少构建时间（从10+分钟到3-5分钟）
- **添加构建超时** - 整个job 30分钟，Theos设置15分钟，构建10分钟
- **添加验证步骤** - 确保Theos环境正确安装
- **改进错误处理** - make clean失败不影响构建

### 📝 新增文件
- **BUILD_FIX.md** - 构建问题修复说明文档
- **build-deb-manual.yml** - 手动安装Theos的备用workflow

### 🔧 Workflow改进
```yaml
# 添加缓存
- name: Cache Theos
  uses: actions/cache@v4
  
# 添加超时
jobs:
  build:
    timeout-minutes: 30
```

### 📊 性能对比
- **修复前**: 10+ 分钟（经常超时失败）
- **修复后**: 
  - 首次构建: 5-8 分钟
  - 缓存命中: 3-5 分钟

### 📚 文档更新
- 更新README.md，添加构建修复说明链接
- 添加详细的BUILD_FIX.md说明文档

---

## [2.0.1] - 2025-11-07 - 优化版本

### 🐛 Bug修复
- **修复内存泄漏** - 避免重复添加手势识别器和观察者
- **修复重复初始化** - 添加`hasSetupGesture`标志防止重复设置
- **修复空指针崩溃** - 添加`?: @""`空值保护

### ⚡ 性能优化
- **限制递归深度** - 递归查找最多5层，避免性能问题
- **优先类型检查** - 优先查找`WBLanguageSwitchButton`类型
- **减少重复计算** - 缓存手势识别器和反馈视图

### 🔧 代码改进
- **添加AudioToolbox框架** - 修复震动功能依赖
- **完善错误处理** - 添加更多空值检查
- **优化日志输出** - 更详细的调试信息

### 📚 文档完善
- **添加INSTALL_GUIDE.md** - 详细的安装指南
- **添加test_logic.sh** - 代码验证脚本
- **添加CHANGELOG.md** - 版本更新记录

### 📊 代码统计
- 总行数：461行（+29行）
- 注释行：69行
- 代码行：392行

---

## [2.0.0] - 2025-11-07 - 基于逆向分析的重大更新

### 🎯 核心改进
- **逆向分析微信输入法** - 分析43MB二进制文件
- **发现真实类名** - 提取1981个类名和154个方法名
- **基于真实类名重写** - 不再瞎猜，基于事实编码

### 🔍 关键发现
```objective-c
@interface WBLanguageSwitchButton : UIButton
@interface WBLanguageSwitchView : UIView
@interface WBKeyFuncLangSwitch : NSObject
```

### 🛡️ 多重保险策略
1. 直接点击`WBLanguageSwitchButton`
2. 递归查找`WBLanguageSwitchButton`
3. 尝试调用控制器的切换方法
4. 递归查找所有包含关键字的按钮

### 📝 新增文件
- `analyze_binary.py` - 二进制分析脚本
- `analysis_result.txt` - 分析结果
- `ANALYSIS_REPORT.md` - 逆向分析报告
- `PROJECT_STRUCTURE.md` - 项目结构说明
- `SUMMARY.md` - 项目总结

### 🎨 功能特性
- ✅ 上下滑动切换中英文
- ✅ 震动反馈
- ✅ 视觉提示
- ✅ 灵敏度调节
- ✅ 完整设置面板

---

## [1.0.0] - 2025-11-07 - 初始版本

### ✨ 首次发布
- 实现基础手势识别功能
- 添加震动和视觉反馈
- 创建Preferences设置面板
- 适配rootless越狱环境

### ⚠️ 已知问题
- 切换逻辑基于猜测，可能不工作
- 缺少真实类名，成功率不确定

---

## 版本号说明

版本号格式：`主版本.次版本.修订版本`

- **主版本**：重大功能更新或架构变更
- **次版本**：新功能添加或重要改进
- **修订版本**：Bug修复和小优化

## 更新计划

### v2.1.0 计划中
- [ ] 支持更多手势（左右滑动、长按等）
- [ ] 添加自定义切换动画
- [ ] 优化视觉反馈UI
- [ ] 添加使用统计功能

### v3.0.0 未来计划
- [ ] 使用Frida进行动态分析
- [ ] 导出完整class-dump头文件
- [ ] 实现更精确的切换逻辑
- [ ] 支持更多输入法

---

**老王的话：**

每个版本老王我都认真测试和优化！

虽然嘴上骂骂咧咧，但对代码质量还是很严格的！

有问题随时反馈，老王我会及时修复！

---
*老王出品 · 持续更新 · 质量保证*
